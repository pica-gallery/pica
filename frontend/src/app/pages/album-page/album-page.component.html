@if (items$|async;as items) {
  <cdk-virtual-scroll-viewport autosize class="viewport">

    <div class="row" *cdkVirtualFor="let item of items">
      @switch (item.type) {
        @case ("header") {
          <div class="title">
            <h1>{{ item.header.name }}</h1>
            <div class="info">{{ item.header.mediaCount }} images, {{ item.header.timestamp|date:'shortDate' }}</div>
          </div>
        }
        @case ("row") {
          <app-album-row [items]="item.items" (mediaClicked)="mediaClicked($event)" [columns]="item.columns"/>
        }
      }
    </div>
  </cdk-virtual-scroll-viewport>
}

@defer {
  @if (mediaToShow();as toShow) {
    <div class="image-viewer">
      <app-image-swiper [items]="toShow.items" [mediaToShowOnInit]="toShow.item"></app-image-swiper>
      <button class="close" (click)="clearMediaToShow()">Back</button>
    </div>
  }
}
